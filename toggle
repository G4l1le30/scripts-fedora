#!/usr/bin/env python3
# use sudo ln -s "$HOME/scripts/toggle" /usr/local/bin/toggle for symbolic link
import os

HOSTS = "/etc/hosts"
DOMAIN = "chatgpt.com"
DOMAIN2 = "gemini.google.com"
LINE = f"127.0.0.1 {DOMAIN} 127.0.0.1 {DOMAIN2}\n"


def toggle():
    with open(HOSTS, "r") as f:
        lines = f.readlines()

    new_lines = []
    found_blocking_line = False
    
    for line in lines:
        if DOMAIN in line or DOMAIN2 in line:
            found_blocking_line = True
            # Do not add this line to new_lines, effectively removing it
        else:
            new_lines.append(line)

    with open(HOSTS, "w") as f:
        if found_blocking_line:
            # UNBLOCK: write all lines except the ones containing DOMAIN or DOMAIN2
            f.writelines(new_lines)
            print(f"[+] {DOMAIN} and {DOMAIN2} enabled (unblocked).")
        else:
            # BLOCK: add the LINE and write all lines
            new_lines.append(LINE)
            f.writelines(new_lines)
            print(f"[+] {DOMAIN} and {DOMAIN2} disabled (blocked).")


if __name__ == "__main__":
    if os.geteuid() != 0:
        print(f"current user id:{os.geteuid()}")
        print("Jalankan dengan sudo!")
    else:
        print(f"current user id:{os.geteuid()}")
        toggle()
