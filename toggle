#!/usr/bin/env python3
# sudo mv toggle /usr/local/bin/toggle
import os
import sys

HOSTS = "/etc/hosts"
DOMAIN = "chatgpt.com"
DOMAIN2 = "gemini.google.com"
LINE = f"127.0.0.1 {DOMAIN} 127.0.0.1 {DOMAIN2}\n"


def is_blocked():
    """Check if the domains are currently blocked in the hosts file."""
    try:
        with open(HOSTS, "r") as f:
            for line in f:
                if DOMAIN in line or DOMAIN2 in line:
                    return True
    except FileNotFoundError:
        return False
    return False


def block():
    """Ensures the domains are blocked."""
    if is_blocked():
        print(f"[+] {DOMAIN} and {DOMAIN2} are already blocked.")
        return

    try:
        with open(HOSTS, "a") as f:
            f.write(LINE)
        print(f"[+] {DOMAIN} and {DOMAIN2} are now disabled (blocked).")
    except PermissionError:
        print("Error: Permission denied. Please run with sudo.")
        sys.exit(1)


def unblock():
    """Ensures the domains are unblocked."""
    if not is_blocked():
        print(f"[+] {DOMAIN} and {DOMAIN2} are already unblocked.")
        return

    try:
        with open(HOSTS, "r") as f:
            lines = f.readlines()

        with open(HOSTS, "w") as f:
            for line in lines:
                if DOMAIN not in line and DOMAIN2 not in line:
                    f.write(line)
            print(f"[+] {DOMAIN} and {DOMAIN2} are now enabled (unblocked).")
    except PermissionError:
        print("Error: Permission denied. Please run with sudo.")
        sys.exit(1)


if __name__ == "__main__":
    if os.geteuid() != 0:
        print("This script requires root privileges. Please run with sudo.")
        sys.exit(1)

    if len(sys.argv) not in [1, 2]:
        print("Usage: sudo toggle [block|unblock]")
        sys.exit(1)

    action = None
    if len(sys.argv) == 2:
        action = sys.argv[1]

    if action == "block":
        block()
    elif action == "unblock":
        unblock()
    else:
        # If no argument or an invalid one is given, print the current status.
        if is_blocked():
            print(f"Current status: BLOCKED ({DOMAIN}, {DOMAIN2})")
        else:
            print(f"Current status: UNBLOCKED ({DOMAIN}, {DOMAIN2})")
        print("Usage: sudo toggle [block|unblock]")
