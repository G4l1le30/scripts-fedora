#!/usr/bin/env python3
from playwright.sync_api import sync_playwright
from urllib.parse import urlparse
from datetime import datetime
import re

def safe_filename_from_url(url):
    parsed = urlparse(url)
    domain = parsed.netloc or parsed.path  # jaga2 kalau user lupa https
    domain = re.sub(r"[^a-zA-Z0-9.-]", "_", domain)
    timestamp = datetime.now().strftime("%Y%m%d-%H%M%S")
    return f"{domain}-{timestamp}.png"

def take_screenshot(url):
    filename = safe_filename_from_url(url)

    with sync_playwright() as p:
        browser = p.chromium.launch(headless=True)
        context = browser.new_context()
        page = context.new_page()

        page.goto(url)
        page.wait_for_load_state("networkidle")

        page.screenshot(path=filename)

        browser.close()
        print(f"[+] Screenshot saved as {filename}")

if __name__ == "__main__":
    import argparse

    parser = argparse.ArgumentParser(description="Take a screenshot of a URL.")
    parser.add_argument("url", nargs="?", default=None, help="The URL to take a screenshot of.")
    args = parser.parse_args()

    url = args.url
    if not url:
        url = input("URL: ").strip()

    if not url.startswith("http"):
        url = "https://" + url

    take_screenshot(url)
